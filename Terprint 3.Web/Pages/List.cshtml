@page
@model Terprint_3.Pages.ListModel
@{

    // Terprint_3.Pages.TableModel tm = new Terprint_3.Pages.TableModel();
    Model.loadData();
}


<form asp-route-matrix="@Model.matrix" asp-route-strain="@Model.strain" method="get">


    <div class="row" style="visibility:hidden;">
        <div class="col-3">
            <label for="size" class="form-label">Matrix Size</label>

            <select name="size" asp-for="size" asp-items="Model.c.OptionsSize" asp-asp-for="strainModel.size" class="form-select"></select>
        </div>
        <div class="col-3">
            <label for="matrix" class="form-label">Matrix Number</label>
            <select name="matrix" asp-for="matrix" asp-items="Model.c.OptionsMatrix" asp-asp-for="strainModel.matrix" class="form-select"></select>
        </div>
        <div class="col-4">
            <label for="strain" class="form-label">Strain/Batch</label>
            <select name="strain" asp-for="strain" asp-items="Model.c.Options" asp-asp-for="strainModel.strain" class="form-select"></select>
        </div>
        <div class="col-2">
            <button type="submit" class="btn btn-primary">Click</button>
        </div>
    </div>

</form>
<div class="container-fluid">

    <div class="row gx-5">
        @foreach (var r in Model.c.TerpValues
        .OrderByDescending(t => t.Rating)
        .Select(t => t.Batch)
        .Distinct()
        .ToList())
        {

            var strain = Model.c.TerpValues.Where(t => t.Batch == r).FirstOrDefault();
            var terps = Model.c.TerpValues.Where(t => t.Batch == r).ToList();
            var urlpart = System.Net.WebUtility.UrlEncode(strain.Strain + "|" + strain.Batch);
            var link = "/Table?size=Medium&matrix=2&strain=" + urlpart;
            var rating = Convert.ToInt32(Model.c.ratings.UserRatings.Where(t => t.batch == strain.Batch).Select(t => t.OverallRating).FirstOrDefault().ToString());
            var counter = 1;
            Model.c.terprintTable(@r, "name");
            <div class="col-12 col-xxl-4 col-xl-4 col-lg-4 col-md-6">
                <div class="row">
                    <div class="col-6 p-3">
                        <a href="@link">@strain.Strain</a><br />
                        <small>                            @(Math.Round((terps.Select(t => t.Value).Sum() * .1), 2))% - @terps.Count </small>

                        <br />
                        <small>
                            @r
                        </small>
                        <br />

                        @while (counter < 11)
                        {
                            if (rating >= counter)
                            {

                                <span class="fa fa-star checked w3-large"></span>

                            }
                            else
                            {
                                <span class="fa fa-star"></span>
                            }
                            counter++;
                        }
                    </div>
                    <div class="col-2 p-3">
                        <div class="float-end">
                            <table style="border:solid 1px;">
                                @{
                                    @Html.Raw(Model.c.outputrows)
                                    ;
                                }
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        }

    </div>
</div>