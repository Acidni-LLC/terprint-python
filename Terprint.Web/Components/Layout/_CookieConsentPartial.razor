@using Microsoft.AspNetCore.Http.Features
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Authentication.Cookies;
@using Microsoft.AspNetCore.Authorization;

@inject IHttpContextAccessor hca 


@if (showBanner)
{
    <div id="cookieConsent" class="alert alert-info alert-dismissible fade show" role="alert">
        This site uses cookies for enhanced security and to improve user experience and requires your consent.
        <Button title="Accept" class="accept-policy close" data-dismiss="alert" aria-label="Close" onclick="@acceptMessage">
            Accept
        </Button>
    </div>
    @code {

    ITrackingConsentFeature consentFeature;
    bool showBanner;
    string cookieString;
    string acceptMessage;

    protected override void OnInitialized()
    {
        consentFeature = hca.HttpContext.Features.Get<ITrackingConsentFeature>();
        showBanner = !consentFeature?.CanTrack ?? false;
        cookieString = consentFeature?.CreateConsentCookie();
        acceptMessage = "acceptMessage(\"" + cookieString + "\")";
    }

    }
}
