@page "/RatingList"
@using Microsoft.AspNetCore.Components.QuickGrid
@inject common.AppState.StateContainer.RatingCategory asRatingCategory
@inject common.AppState.StateContainer.Strain asStrain
@inject common.AppState.StateContainer.Batch asBatch
@inject Terprint.Web.Data.TerprintWebContext DB


@{
    RatingCategory = asRatingCategory.RatingCategories.Where(t => t.RatingCategoryId == RatingCategoryID).FirstOrDefault().CategoryName;
}
<h3>@RatingCategory</h3>
<QuickGrid Class="table" TGridItem="Models.Rating" Items="DB.Rating.Where(t=>t.RatingCategoryID== RatingCategoryID) .OrderByDescending(t=>t.Value).AsQueryable()">
    <TemplateColumn Context="rating" Title="Strain">
        @{
            string strain = asStrain.Strains.Where(t => t.StrainId == asBatch.Batches.Where(t => t.BatchId == rating.BatchID).FirstOrDefault().StrainID).FirstOrDefault().StrainName;
            string link = common.CreateStrainLink(strain);
            MarkupString markupString = new MarkupString(link);
            @markupString
        }
    </TemplateColumn>

    <TemplateColumn Context="rating" Title="              ">
        @{
            if (rating.RatingCategoryID == 1)
            {
                // <span>
                //     <RangeInput   TValue="int" Value="int.Parse(rating.Value)" Min="0" Max="10" Disabled="true" />
                // </span>
                double width = double.Parse(@rating.Value) * 10;
                <div style="width:10em">
                    <Progress Class="mb-3">
                        <ProgressBar Color="ProgressColor.Success" Width="@width" />
                    </Progress>
                </div>
            }
            else if (rating.RatingCategoryID == 2 || rating.RatingCategoryID == 3 || rating.RatingCategoryID == 4 || rating.RatingCategoryID == 6)
            {
                bool val = bool.Parse(rating.Value);
                if (val)
                {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                    </svg>
                }
                else
                {
                    <i class="bi bi-x"></i>

                }
            }
        }

    </TemplateColumn>
    <TemplateColumn Context="rating" Title="Batch">
        @{
            string batch = asBatch.Batches.Where(t => t.BatchId == rating.BatchID).FirstOrDefault().Name;
            string link = common.CreateBatchLink(batch);
            MarkupString markupString = new MarkupString(link);
            @markupString
        }
    </TemplateColumn>
    <PropertyColumn Property="rating => rating.Notes" />
    <PropertyColumn Property="rating => rating.userid" />
</QuickGrid>
@code {
    private RangeInput<int?> rangeInput = default!;
    [SupplyParameterFromQuery]
    public int? RatingCategoryID { get; set; }
    public string? RatingCategory { get; set; }

}
