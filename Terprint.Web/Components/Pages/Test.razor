@page "/Table"
@inject Terprint.Web.Data.TerprintWebContext DB
@using Terprint.Web.Models
@inject NavigationManager NavManager
@inject Terprint.Web.Components.Pages.BatchChooser batchChooser
@inject Terprint.Web.Components.Pages.RatingCategoryChooser ratingCategoryChooser
@rendermode InteractiveServer
@inject common.AppState appstate
@using Microsoft.AspNetCore.Mvc
@using Microsoft.AspNetCore.WebUtilities


@{

    //   NavManager.Refresh();
}
<BatchChooser @bind-BatchId="@batchid" @bind-batch="@batch" @bind-batchdata="@batchData"></BatchChooser>

<TerprintTable @bind-batch="@batch" @bind-matrix="@matrix" @bind-size="@size" @bind-strain="@strain" @bind-batchData="@batchData" @bind-rendermode="@rm"></TerprintTable>

@code {
    protected override async Task OnParametersSetAsync()
    {
        // This event will fire when the parameters change
        // Put your code here. 
        //    NavManager.NavigateTo(NavManager.Uri, true);
        
    }
    public TerprintTable.renderMode rm { get; set; } = TerprintTable.renderMode.tableandtitle;
    protected override void OnInitialized()
    {
        var uri = NavManager.ToAbsoluteUri(NavManager.Uri);
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("matrix", out var _out))
        {
            matrix = Convert.ToInt32(_out);
        }
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("size", out var _size))
        {
            size = _size;
        }
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("batch", out var _batchid))
        {
            batch = _batchid;
            batchData = new BatchChooser.BatchData();
            batchData.batch = batch;
        }
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("strain", out var _strain))
        {
            strain = _strain;
        }
    }
    private void setbatch()
    {

    }
    public int? matrix { get; set; } = 1;
    public string? size { get; set; } = "small";
    public int batchid
    {
        get; set;
    } = 0;
    public BatchChooser.BatchData batchData
    {

        get; set;
    }
    private BatchChooser.BatchData batchdata { get; set; }
    public string batch { get; set; } = "";
    public string strain { get; set; } = "";

    // batchid == "4281 4009 89411502";
   
    
    
}
